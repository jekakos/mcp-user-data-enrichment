# MCP Server Refactoring Guide

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### üìÅ –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:

```
src/
‚îú‚îÄ‚îÄ mcp-server.js                    # –û—Å–Ω–æ–≤–Ω–æ–π MCP —Å–µ—Ä–≤–µ—Ä (stdio)
‚îú‚îÄ‚îÄ streamable-http-wrapper.js       # HTTP wrapper (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
‚îú‚îÄ‚îÄ http-wrapper.js                  # HTTP wrapper (–ø–æ–ª–Ω—ã–π)
‚îú‚îÄ‚îÄ mcp-manager.js                   # –ú–µ–Ω–µ–¥–∂–µ—Ä MCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
‚îî‚îÄ‚îÄ handlers/
    ‚îú‚îÄ‚îÄ mcp-handler.js              # –ì–ª–∞–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
    ‚îú‚îÄ‚îÄ initialize.js               # –û–±—Ä–∞–±–æ—Ç–∫–∞ initialize
    ‚îú‚îÄ‚îÄ tools.js                    # –û–±—Ä–∞–±–æ—Ç–∫–∞ tools/list –∏ tools/call
    ‚îú‚îÄ‚îÄ resources.js                # –û–±—Ä–∞–±–æ—Ç–∫–∞ resources/list –∏ resources/read
    ‚îî‚îÄ‚îÄ notifications.js            # –û–±—Ä–∞–±–æ—Ç–∫–∞ notifications –∏ ping
```

### üîß –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

#### 1. **–í—ã–¥–µ–ª–µ–Ω MCP Manager** (`mcp-manager.js`)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ MCP –ø—Ä–æ—Ü–µ—Å—Å–æ–º
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
- –ú–µ—Ç–æ–¥—ã –¥–ª—è tools –∏ resources

#### 2. **–°–æ–∑–¥–∞–Ω—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**

**`handlers/initialize.js`**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `initialize` –∑–∞–ø—Ä–æ—Å–∞
- –í–æ–∑–≤—Ä–∞—Ç capabilities –∏ server info

**`handlers/tools.js`**
- `handleToolsList()` - —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- `handleToolsCall()` - –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

**`handlers/resources.js`**
- `handleResourcesList()` - —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤
- `handleResourcesRead()` - —á—Ç–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

**`handlers/notifications.js`**
- `handleNotificationsInitialized()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- `handlePing()` - ping notification

**`handlers/mcp-handler.js`**
- –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Ç–æ–¥–∞–º MCP
- –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –º–µ—Ç–æ–¥–æ–≤ (GET, POST, DELETE)

#### 3. **–£–ø—Ä–æ—â–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª** (`streamable-http-wrapper.js`)
- –¢–æ–ª—å–∫–æ Express –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- Middleware –∏ CORS
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- Graceful shutdown

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
2. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –ö–æ–¥ –ª–µ–≥—á–µ –ø–æ–Ω–∏–º–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
3. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
4. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
5. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ú–æ–¥—É–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

### üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
# –ó–∞–ø—É—Å–∫ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
node src/streamable-http-wrapper.js

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
node test-streamable.js
node test-streamable-resources.js
node test-mcp-inspector-ping.js
```

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:

- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: 100% —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å MCP Inspector –∏ Smithery
- **–ö–æ–¥**: –ë–æ–ª–µ–µ —á–∏—Å—Ç—ã–π –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–π

### üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è:

–°—Ç–∞—Ä—ã–π –∫–æ–¥ –≤ `streamable-http-wrapper.js` (400+ —Å—Ç—Ä–æ–∫) —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞:
- `streamable-http-wrapper.js` (60 —Å—Ç—Ä–æ–∫)
- `mcp-manager.js` (120 —Å—Ç—Ä–æ–∫)
- `handlers/` (5 —Ñ–∞–π–ª–æ–≤, ~200 —Å—Ç—Ä–æ–∫)

**–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –æ—Å—Ç–∞–ª–æ—Å—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–µ–º –∂–µ, –Ω–æ –∫–æ–¥ —Å—Ç–∞–ª –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª–µ–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–º!**
